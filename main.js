!function(){"use strict";function e(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class t{constructor(t,s,r){let{data:i,handleCardPopup:o,handleCardLike:n,handleCardUnlike:a,handleTrashPopup:l}=t;e(this,"_getTemplate",(()=>document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0))),e(this,"generateCard",(()=>{this._element=this._getTemplate(),this._element.setAttribute("id",this._id);const e=this._element.querySelector(".card__footer-title"),t=this._element.querySelector(".card__image");return this._cardLikeButton=this._element.querySelector(".button_type_like"),this._cardLikesCount=this._element.querySelector(".card__footer-likes"),this._cardTrashButton=this._element.querySelector(".button_type_trash"),this._cardImageButton=this._element.querySelector(".button_type_image"),e.textContent=this._title,t.src=this._link,t.alt="A Scenic Photo of ".concat(this._title),this._cardLikesCount.textContent=this.likes.length,this._setEventListeners(),this._element})),e(this,"_handleLikeIcon",(()=>{this._isLiked=!this._isLiked,this._isLiked?this._handleCardLike(this._id):this._handleCardUnlike(this._id)})),e(this,"_checkLikeIcon",(()=>{for(let e=0;e<this.likes.length;e++)if(this.likes[e]._id===this._userId)return this._isLiked=!0,void this._cardLikeButton.classList.toggle("button_type_like_filled")})),e(this,"_checkCardOwnerId",(()=>{this._userId!==this._ownerid&&(this._cardTrashButton.remove(),this._cardTrashButton=null)})),e(this,"handleTrashIcon",(()=>{this._element.remove(),this._element=null})),this._data=i,this._title=i.name,this._link=i.link,this.likes=i.likes,this._id=i._id,this._userId=r,this._ownerid=i.owner._id,this._isLiked=!1,this.likes.includes(this._userId)?this._isLiked=!0:this._isLiked=!1,this._cardSelector=s,this._handleCardPopup=o,this._handleCardLike=n,this._handleCardUnlike=a,this._handleTrashPopup=l}updateLikes(e){this.likes=e.likes,this._cardLikesCount.textContent="".concat(this.likes.length),this._cardLikeButton.classList.toggle("button_type_like_filled")}_setEventListeners(){this._cardTrashButton.addEventListener("click",(()=>{this._handleTrashPopup(this._id)})),this._cardImageButton.addEventListener("click",(()=>this._handleCardPopup({name:this._title,link:this._link}))),this._cardLikeButton.addEventListener("click",this._handleLikeIcon),this._checkCardOwnerId(),this._checkLikeIcon()}}class s{constructor(e,t){var s,r;r=()=>this._inputEls.every((e=>e.validity.valid)),(s="_checkFormValidity")in this?Object.defineProperty(this,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[s]=r,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._form=document.querySelector(t),this._inputEls=Array.from(this._form.querySelectorAll(this._inputSelector)),this._submitButton=this._form.querySelector(".".concat(this._submitButtonSelector))}_showInputError(e){const t=this._form.querySelector("#".concat(e.id,"-error"));e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._form.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_toggleInputError(e){e.validity.valid?this._hideInputError(e):this._showInputError(e)}toggleButtonState(){this._checkFormValidity()?(this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1):(this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0)}resetValidation(){this.toggleButtonState(),this._inputEls.forEach((e=>{this._hideInputError(e)}))}_setEventListeners(){this._inputEls.forEach((e=>{e.addEventListener("input",(t=>{this._toggleInputError(e),this.toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault()})),this._setEventListeners()}}const r=document.querySelector(".button_type_edit"),i=document.querySelector(".button_type_edit-alt"),o=document.querySelector(".profile-modal"),n=document.querySelector(".button_type_add"),a=document.querySelector(".card-modal"),l=document.querySelector(".profile"),c=o.querySelector(".form"),h=(document.querySelector(".profile__name"),document.querySelector(".profile__desc"),document.querySelector(".profile__image"),c.querySelector(".form__input_type_name")),d=c.querySelector(".form__input_type_desc"),u=a.querySelector(".form"),_=(u.querySelector(".form__input_type_name"),u.querySelector(".form__input_type_desc"),u.querySelector(".form__submit"),document.querySelector(".image-modal")),m=(_.querySelector(".modal__image"),_.querySelector(".modal__header"),document.querySelector(".delete-modal").querySelector(".form__input-hidden")),p={formSelector:".form",inputSelector:".form__input",submitButtonSelector:"form__submit",inactiveButtonClass:"form__submit_inactive",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},f={cardPopup:".card-modal",imagePopup:".image-modal",profilePopup:".profile-modal",profilePicPopup:".profile-pic-modal",deletePopup:".delete-modal",cardForm:".card-form",profileForm:".profile-form",profilePicForm:".profile-pic-form",cardTemplate:"#card",userNameSelector:".profile__name",userJobSelector:".profile__desc",userImageSelector:".profile__image"};class k{constructor(e){var t,s;s=e=>{27===e.keyCode&&this.close()},(t="_handleEscClose")in this?Object.defineProperty(this,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):this[t]=s,this._popup=document.querySelector(e),this._closeButton=this._popup.querySelector(".button_type_close")}open(){this._popup.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popup.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_closeModalOnRemoteClick(e){e.target===this._popup&&this.close()}setEventListeners(){this._closeButton.addEventListener("click",(()=>this.close())),this._popup.addEventListener("mousedown",(e=>this._closeModalOnRemoteClick(e)))}}class y extends k{constructor(e,t){super(e),this._handleSubmit=t,this._form=this._popup.querySelector(".form"),this._inputEls=Array.from(this._form.querySelectorAll(".form__input")),this._submitBtn=this._form.querySelector(".form__submit"),this._submitBtnText=this._submitBtn.textContent}_getInputValues(){const e={};return this._inputEls.forEach((t=>{e[t.name]=t.value})),e}close(){this._form.reset(),super.close()}renderLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Saving...";this._submitBtn.textContent=e?t:this._submitBtnText}setEventListeners(){super.setEventListeners(),this._form.addEventListener("submit",(e=>{e.preventDefault(),this.renderLoading(!0);const t=this._getInputValues();this._handleSubmit(t)}))}}class g{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._section=document.querySelector(t)}renderItems(){this._items.forEach(this._renderer)}addItem(e){this._section.append(e)}addNewItem(e){this._section.prepend(e)}}const b=e=>{const s=new t({data:e,handleCardPopup:e=>{B.open(e)},handleCardLike:e=>{L.addCardLike(e).then((e=>s.updateLikes(e))).catch((e=>console.log(e)))},handleCardUnlike:e=>{L.removeCardLike(e).then((e=>s.updateLikes(e))).catch((e=>console.log(e)))},handleTrashPopup:e=>{var t;t=e,m.value=t,P.open()}},f.cardTemplate,l.id);return s.generateCard()},S=new class{constructor(e){let{userNameSelector:t,userJobSelector:s,userImageSelector:r}=e;this._nameElement=document.querySelector(t),this._jobElement=document.querySelector(s),this._imageElement=document.querySelector(r)}getUserInfo(){return{userName:this._nameElement.textContent,userJob:this._jobElement.textContent}}setUserInfo(e){let{userName:t,userJob:s}=e;this._nameElement.textContent=t,this._jobElement.textContent=s}setUserImage(e){let{userImage:t}=e;this._imageElement.src=t}}(f),L=new class{constructor(e){this.url=e.baseUrl,this.headers=e.headers}_checkResponse(e){return e.ok?e.json():Promise.reject("Error ".concat(e.status))}getUserData(){return fetch("".concat(this.url,"users/me"),{headers:this.headers}).then(this._checkResponse)}getInitialCards(){return fetch("".concat(this.url,"cards"),{headers:this.headers}).then(this._checkResponse)}submitUserEdit(e){return fetch("".concat(this.url,"users/me"),{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e.name,about:e.about})}).then(this._checkResponse)}postNewCard(e){return fetch("".concat(this.url,"cards"),{method:"POST",headers:this.headers,body:JSON.stringify({name:e.name,link:e.link})}).then(this._checkResponse)}addCardLike(e){return fetch("".concat(this.url,"cards/likes/").concat(e),{method:"PUT",headers:this.headers}).then(this._checkResponse)}removeCardLike(e){return fetch("".concat(this.url,"cards/likes/").concat(e),{method:"DELETE",headers:this.headers}).then(this._checkResponse)}deleteCard(e){return fetch("".concat(this.url,"cards/").concat(e),{method:"DELETE",headers:this.headers}).then(this._checkResponse)}updateProfilePicture(e){return fetch("".concat(this.url,"users/me/avatar"),{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse)}}({baseUrl:"https://around.nomoreparties.co/v1/group-12/",headers:{authorization:"fa002eaa-cfdc-49b2-ba7a-7640eb468742","content-type":"application/json"}});let E=null;Promise.all([L.getInitialCards(),L.getUserData()]).then((e=>{let[t,s]=e;var r;r=s,S.setUserInfo({userName:r.name,userJob:r.about}),S.setUserImage({userImage:r.avatar}),l.setAttribute("id",r._id),E=new g({items:t,renderer:e=>{const t=b(e);E.addItem(t)}},".cards"),E.renderItems()})).catch((e=>console.log(e)));const v=new y(f.cardPopup,(e=>{const t={name:e.place,link:e.link};L.postNewCard(t).then((e=>{const t=b(e);E.addNewItem(t)})).catch((e=>console.log(e))).finally((()=>{v.close(),v.renderLoading(!1)}))}));v.setEventListeners(),n.addEventListener("click",(()=>{C.resetValidation(),v.open()}));const C=new s(p,f.cardForm);C.enableValidation();const I=new y(f.profilePopup,(e=>{const t={name:e.profile,about:e.desc};L.submitUserEdit(t).then((e=>{S.setUserInfo({userName:e.name,userJob:e.about})})).catch((e=>console.log(e))).finally((()=>{I.close(),I.renderLoading(!1)}))}));I.setEventListeners();const q=new s(p,f.profileForm);q.enableValidation(),r.addEventListener("click",(()=>{!function(){const{userName:e,userJob:t}=S.getUserInfo();h.value=e,d.value=t}(),q.resetValidation(),I.open()}));const P=new y(f.deletePopup,(e=>{const t=document.getElementById(e.cardId);L.deleteCard(e.cardId).then((()=>{t.remove()})).catch((e=>console.log(e))).finally((()=>{P.close(),P.renderLoading(!1)}))}));P.setEventListeners();const B=new class extends k{constructor(e){super(e),this._imageElement=this._popup.querySelector(".modal__image"),this._imageCaption=this._popup.querySelector(".modal__header")}open(e){this._imageElement.src=e.link,this._imageElement.alt="A full size view of ".concat(e.name),this._imageCaption.textContent=e.name,super.open()}}(f.imagePopup);B.setEventListeners();const w=new s(p,f.profilePicForm);w.enableValidation();const T=new y(f.profilePicPopup,(e=>{L.updateProfilePicture(e.profilepic).then((e=>{S.setUserImage({userImage:e.avatar})})).catch((e=>console.log(e))).finally((()=>{T.close(),T.renderLoading(!1)}))}));T.setEventListeners(),i.addEventListener("click",(()=>{w.resetValidation(),T.open()}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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ckcsRUFBZVMsUUFDZlQsRUFBZTRCLGVBQWMsRUFBN0IsR0FQSixJQVdGNUIsRUFBZWlCLG9CQUVmcEMsRUFBcUI3QyxpQkFBaUIsU0FBUyxLQUM3QzhLLEVBQXdCeEksa0JBQ3hCMEIsRUFBZVksTUFBZixHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy91dGlscy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9Qb3B1cFdpdGhGb3JtLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3NlX3Byb2plY3RfYXJvdW5kdGhldXMvLi9zcmMvY29tcG9uZW50cy9BcGkuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9hcm91bmR0aGV1cy8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBDYXJkIHtcclxuICBjb25zdHJ1Y3Rvcih7ZGF0YSwgaGFuZGxlQ2FyZFBvcHVwLCBoYW5kbGVDYXJkTGlrZSwgaGFuZGxlQ2FyZFVubGlrZSwgaGFuZGxlVHJhc2hQb3B1cH0sIGNhcmRTZWxlY3RvciwgdXNlcklkKSB7XHJcbiAgICB0aGlzLl9kYXRhID0gZGF0YTtcclxuICAgIHRoaXMuX3RpdGxlID0gZGF0YS5uYW1lO1xyXG4gICAgdGhpcy5fbGluayA9IGRhdGEubGluaztcclxuICAgIHRoaXMubGlrZXMgPSBkYXRhLmxpa2VzO1xyXG4gICAgdGhpcy5faWQgPSBkYXRhLl9pZDtcclxuICAgIHRoaXMuX3VzZXJJZCA9IHVzZXJJZDtcclxuICAgIHRoaXMuX293bmVyaWQgPSBkYXRhLm93bmVyLl9pZDtcclxuICAgIHRoaXMuX2lzTGlrZWQgPSBmYWxzZTtcclxuXHJcbiAgICBpZiAodGhpcy5saWtlcy5pbmNsdWRlcyh0aGlzLl91c2VySWQpKSB7XHJcbiAgICAgIHRoaXMuX2lzTGlrZWQgPSB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5faXNMaWtlZCA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX2NhcmRTZWxlY3RvciA9IGNhcmRTZWxlY3RvcjtcclxuICAgIHRoaXMuX2hhbmRsZUNhcmRQb3B1cCA9IGhhbmRsZUNhcmRQb3B1cDtcclxuICAgIHRoaXMuX2hhbmRsZUNhcmRMaWtlID0gaGFuZGxlQ2FyZExpa2U7XHJcbiAgICB0aGlzLl9oYW5kbGVDYXJkVW5saWtlID0gaGFuZGxlQ2FyZFVubGlrZTtcclxuICAgIHRoaXMuX2hhbmRsZVRyYXNoUG9wdXAgPSBoYW5kbGVUcmFzaFBvcHVwO1xyXG4gIH1cclxuXHJcbiAgX2dldFRlbXBsYXRlID0gKCkgPT4ge1xyXG4gICAgcmV0dXJuIGRvY3VtZW50XHJcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcclxuICAgICAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXHJcbiAgICAgIC5jbG9uZU5vZGUodHJ1ZSk7XHJcbiAgfTtcclxuXHJcbiAgZ2VuZXJhdGVDYXJkID0gKCkgPT4ge1xyXG4gICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX2dldFRlbXBsYXRlKCk7XHJcbiAgICB0aGlzLl9lbGVtZW50LnNldEF0dHJpYnV0ZShcImlkXCIsIHRoaXMuX2lkKTtcclxuICAgIGNvbnN0IGNhcmRUaXRsZSA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19mb290ZXItdGl0bGVcIik7XHJcbiAgICBjb25zdCBjYXJkSW1hZ2UgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XHJcbiAgICB0aGlzLl9jYXJkTGlrZUJ1dHRvbiA9IHRoaXMuX2VsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5idXR0b25fdHlwZV9saWtlXCIpO1xyXG4gICAgdGhpcy5fY2FyZExpa2VzQ291bnQgPSB0aGlzLl9lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZm9vdGVyLWxpa2VzXCIpO1xyXG4gICAgdGhpcy5fY2FyZFRyYXNoQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmJ1dHRvbl90eXBlX3RyYXNoXCIpO1xyXG4gICAgdGhpcy5fY2FyZEltYWdlQnV0dG9uID0gdGhpcy5fZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmJ1dHRvbl90eXBlX2ltYWdlXCIpO1xyXG5cclxuICAgIGNhcmRUaXRsZS50ZXh0Q29udGVudCA9IHRoaXMuX3RpdGxlO1xyXG4gICAgY2FyZEltYWdlLnNyYyA9IHRoaXMuX2xpbms7XHJcbiAgICBjYXJkSW1hZ2UuYWx0ID0gYEEgU2NlbmljIFBob3RvIG9mICR7dGhpcy5fdGl0bGV9YDtcclxuICAgIHRoaXMuX2NhcmRMaWtlc0NvdW50LnRleHRDb250ZW50ID0gdGhpcy5saWtlcy5sZW5ndGg7XHJcblxyXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudDtcclxuICB9O1xyXG5cclxuICB1cGRhdGVMaWtlcyhyZXMpIHtcclxuICAgIHRoaXMubGlrZXMgPSByZXMubGlrZXM7XHJcbiAgICB0aGlzLl9jYXJkTGlrZXNDb3VudC50ZXh0Q29udGVudCA9IGAke3RoaXMubGlrZXMubGVuZ3RofWA7XHJcbiAgICB0aGlzLl9jYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QudG9nZ2xlKFwiYnV0dG9uX3R5cGVfbGlrZV9maWxsZWRcIik7XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlTGlrZUljb24gPSAoKSA9PiB7XHJcbiAgICB0aGlzLl9pc0xpa2VkID0gIXRoaXMuX2lzTGlrZWQ7XHJcbiAgICBpZiAodGhpcy5faXNMaWtlZCkge1xyXG4gICAgICB0aGlzLl9oYW5kbGVDYXJkTGlrZSh0aGlzLl9pZCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9oYW5kbGVDYXJkVW5saWtlKHRoaXMuX2lkKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBfY2hlY2tMaWtlSWNvbiA9ICgpID0+IHtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5saWtlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBpZiAodGhpcy5saWtlc1tpXS5faWQgPT09IHRoaXMuX3VzZXJJZCkge1xyXG4gICAgICAgIHRoaXMuX2lzTGlrZWQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuX2NhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoXCJidXR0b25fdHlwZV9saWtlX2ZpbGxlZFwiKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9jaGVja0NhcmRPd25lcklkID0gKCkgPT4ge1xyXG4gICAgaWYgKHRoaXMuX3VzZXJJZCAhPT0gdGhpcy5fb3duZXJpZCkge1xyXG4gICAgICB0aGlzLl9jYXJkVHJhc2hCdXR0b24ucmVtb3ZlKCk7XHJcbiAgICAgIHRoaXMuX2NhcmRUcmFzaEJ1dHRvbiA9IG51bGw7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBoYW5kbGVUcmFzaEljb24gPSAoKSA9PiB7XHJcbiAgICB0aGlzLl9lbGVtZW50LnJlbW92ZSgpO1xyXG4gICAgdGhpcy5fZWxlbWVudCA9IG51bGw7XHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9jYXJkVHJhc2hCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgdGhpcy5faGFuZGxlVHJhc2hQb3B1cCh0aGlzLl9pZCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9jYXJkSW1hZ2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+XHJcbiAgICAgIHRoaXMuX2hhbmRsZUNhcmRQb3B1cCh7bmFtZTogdGhpcy5fdGl0bGUsIGxpbms6IHRoaXMuX2xpbmt9KVxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLl9jYXJkTGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5faGFuZGxlTGlrZUljb24pO1xyXG5cclxuICAgIHRoaXMuX2NoZWNrQ2FyZE93bmVySWQoKTtcclxuICAgIHRoaXMuX2NoZWNrTGlrZUljb24oKTtcclxuICB9XHJcbn0iLCJleHBvcnQgY2xhc3MgRm9ybVZhbGlkYXRvciB7XHJcbiAgY29uc3RydWN0b3Ioc2V0dGluZ3MsIGZvcm1FbGVtZW50KSB7XHJcbiAgICB0aGlzLl9pbnB1dFNlbGVjdG9yID0gc2V0dGluZ3MuaW5wdXRTZWxlY3RvcjtcclxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yID0gc2V0dGluZ3Muc3VibWl0QnV0dG9uU2VsZWN0b3I7XHJcbiAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gc2V0dGluZ3MuaW5hY3RpdmVCdXR0b25DbGFzcztcclxuICAgIHRoaXMuX2lucHV0RXJyb3JDbGFzcyA9IHNldHRpbmdzLmlucHV0RXJyb3JDbGFzcztcclxuICAgIHRoaXMuX2Vycm9yQ2xhc3MgPSBzZXR0aW5ncy5lcnJvckNsYXNzO1xyXG5cclxuICAgIHRoaXMuX2Zvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGZvcm1FbGVtZW50KTtcclxuXHJcbiAgICB0aGlzLl9pbnB1dEVscyA9IEFycmF5LmZyb20oXHJcbiAgICAgIHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvckFsbCh0aGlzLl9pbnB1dFNlbGVjdG9yKVxyXG4gICAgKTtcclxuICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbiA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihcclxuICAgICAgYC4ke3RoaXMuX3N1Ym1pdEJ1dHRvblNlbGVjdG9yfWBcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBfc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KSB7XHJcbiAgICBjb25zdCBlcnJvck1lc3NhZ2VFbCA9IHRoaXMuX2Zvcm0ucXVlcnlTZWxlY3RvcihcclxuICAgICAgYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgXHJcbiAgICApO1xyXG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQodGhpcy5faW5wdXRFcnJvckNsYXNzKTtcclxuICAgIGVycm9yTWVzc2FnZUVsLnRleHRDb250ZW50ID0gaW5wdXRFbGVtZW50LnZhbGlkYXRpb25NZXNzYWdlO1xyXG4gICAgZXJyb3JNZXNzYWdlRWwuY2xhc3NMaXN0LmFkZCh0aGlzLl9lcnJvckNsYXNzKTtcclxuICB9XHJcblxyXG4gIF9oaWRlSW5wdXRFcnJvcihpbnB1dEVsZW1lbnQpIHtcclxuICAgIGNvbnN0IGVycm9yTWVzc2FnZUVsID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmBcclxuICAgICk7XHJcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9pbnB1dEVycm9yQ2xhc3MpO1xyXG4gICAgZXJyb3JNZXNzYWdlRWwudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gICAgZXJyb3JNZXNzYWdlRWwuY2xhc3NMaXN0LnJlbW92ZSh0aGlzLl9lcnJvckNsYXNzKTtcclxuICB9XHJcblxyXG4gIF90b2dnbGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCkge1xyXG4gICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcclxuICAgICAgdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWxlbWVudCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBfY2hlY2tGb3JtVmFsaWRpdHkgPSAoKSA9PiB7XHJcbiAgICByZXR1cm4gdGhpcy5faW5wdXRFbHMuZXZlcnkoKGlucHV0KSA9PiBpbnB1dC52YWxpZGl0eS52YWxpZCk7XHJcbiAgfTtcclxuXHJcbiAgdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XHJcbiAgICBjb25zdCBpc0Zvcm1WYWxpZCA9IHRoaXMuX2NoZWNrRm9ybVZhbGlkaXR5KCk7XHJcblxyXG4gICAgaWYgKCFpc0Zvcm1WYWxpZCkge1xyXG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24uY2xhc3NMaXN0LmFkZCh0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcclxuICAgICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2luYWN0aXZlQnV0dG9uQ2xhc3MpO1xyXG4gICAgICB0aGlzLl9zdWJtaXRCdXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcclxuICAgIHRoaXMudG9nZ2xlQnV0dG9uU3RhdGUoKTtcclxuXHJcbiAgICB0aGlzLl9pbnB1dEVscy5mb3JFYWNoKChpbnB1dEVsZW1lbnQpID0+IHtcclxuICAgICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbGVtZW50KTtcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XHJcbiAgICB0aGlzLl9pbnB1dEVscy5mb3JFYWNoKChlbGVtZW50KSA9PiB7XHJcbiAgICAgIGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIChlKSA9PiB7XHJcbiAgICAgICAgdGhpcy5fdG9nZ2xlSW5wdXRFcnJvcihlbGVtZW50KTtcclxuICAgICAgICB0aGlzLnRvZ2dsZUJ1dHRvblN0YXRlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBlbmFibGVWYWxpZGF0aW9uKCkge1xyXG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuX3NldEV2ZW50TGlzdGVuZXJzKCk7XHJcbiAgfVxyXG59XHJcbiIsImNvbnN0IGVkaXRQcm9maWxlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5idXR0b25fdHlwZV9lZGl0XCIpO1xyXG5jb25zdCBlZGl0UHJvZmlsZVBpY0J1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuYnV0dG9uX3R5cGVfZWRpdC1hbHRcIik7XHJcbmNvbnN0IHByb2ZpbGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZS1tb2RhbFwiKTtcclxuXHJcbmNvbnN0IGFkZENhcmRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJ1dHRvbl90eXBlX2FkZFwiKTtcclxuY29uc3QgY2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkLW1vZGFsXCIpO1xyXG5cclxuY29uc3QgcHJvZmlsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZVwiKTtcclxuY29uc3QgcHJvZmlsZUZvcm0gPSBwcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5mb3JtXCIpO1xyXG5jb25zdCBwcm9maWxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fbmFtZVwiKTtcclxuY29uc3QgcHJvZmlsZURlc2MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NcIik7XHJcbmNvbnN0IHByb2ZpbGVJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9faW1hZ2VcIik7XHJcbmNvbnN0IHByb2ZpbGVOYW1lSW5wdXQgPSBwcm9maWxlRm9ybS5xdWVyeVNlbGVjdG9yKFwiLmZvcm1fX2lucHV0X3R5cGVfbmFtZVwiKTtcclxuY29uc3QgcHJvZmlsZURlc2NJbnB1dCA9IHByb2ZpbGVGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybV9faW5wdXRfdHlwZV9kZXNjXCIpO1xyXG5cclxuY29uc3QgY2FyZEZvcm0gPSBjYXJkTW9kYWwucXVlcnlTZWxlY3RvcihcIi5mb3JtXCIpO1xyXG5jb25zdCBjYXJkTmFtZUlucHV0ID0gY2FyZEZvcm0ucXVlcnlTZWxlY3RvcihcIi5mb3JtX19pbnB1dF90eXBlX25hbWVcIik7XHJcbmNvbnN0IGNhcmRJbWFnZUlucHV0ID0gY2FyZEZvcm0ucXVlcnlTZWxlY3RvcihcIi5mb3JtX19pbnB1dF90eXBlX2Rlc2NcIik7XHJcbmNvbnN0IGNhcmRGb3JtU3VibWl0ID0gY2FyZEZvcm0ucXVlcnlTZWxlY3RvcihcIi5mb3JtX19zdWJtaXRcIik7XHJcblxyXG5jb25zdCBwb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuaW1hZ2UtbW9kYWxcIik7XHJcbmNvbnN0IHBvcHVwSW1hZ2UgPSBwb3B1cC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcclxuY29uc3QgcG9wdXBIZWFkZXIgPSBwb3B1cC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19oZWFkZXJcIik7XHJcblxyXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZGVsZXRlLW1vZGFsXCIpO1xyXG5jb25zdCBkZWxldGVJbnB1dCA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIuZm9ybV9faW5wdXQtaGlkZGVuXCIpO1xyXG5cclxuY29uc3QgY29uZmlnID0ge1xyXG4gIGZvcm1TZWxlY3RvcjogJy5mb3JtJyxcclxuICBpbnB1dFNlbGVjdG9yOiAnLmZvcm1fX2lucHV0JyxcclxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogJ2Zvcm1fX3N1Ym1pdCcsXHJcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogJ2Zvcm1fX3N1Ym1pdF9pbmFjdGl2ZScsXHJcbiAgaW5wdXRFcnJvckNsYXNzOiAnZm9ybV9faW5wdXRfdHlwZV9lcnJvcicsXHJcbiAgZXJyb3JDbGFzczogJ2Zvcm1fX2lucHV0LWVycm9yX2FjdGl2ZScsXHJcbn1cclxuXHJcbmNvbnN0IGVzY2FwZUtleUNvZGUgPSAyNztcclxuXHJcbmNvbnN0IHNlbGVjdG9ycyA9IHtcclxuICBjYXJkUG9wdXA6IFwiLmNhcmQtbW9kYWxcIixcclxuICBpbWFnZVBvcHVwOiBcIi5pbWFnZS1tb2RhbFwiLFxyXG4gIHByb2ZpbGVQb3B1cDogXCIucHJvZmlsZS1tb2RhbFwiLFxyXG4gIHByb2ZpbGVQaWNQb3B1cDogXCIucHJvZmlsZS1waWMtbW9kYWxcIiwgIFxyXG4gIGRlbGV0ZVBvcHVwOiBcIi5kZWxldGUtbW9kYWxcIixcclxuICBjYXJkRm9ybTogXCIuY2FyZC1mb3JtXCIsXHJcbiAgcHJvZmlsZUZvcm06IFwiLnByb2ZpbGUtZm9ybVwiLFxyXG4gIHByb2ZpbGVQaWNGb3JtOiBcIi5wcm9maWxlLXBpYy1mb3JtXCIsXHJcbiAgY2FyZFRlbXBsYXRlOiBcIiNjYXJkXCIsXHJcbiAgdXNlck5hbWVTZWxlY3RvcjogXCIucHJvZmlsZV9fbmFtZVwiLFxyXG4gIHVzZXJKb2JTZWxlY3RvcjogXCIucHJvZmlsZV9fZGVzY1wiLFxyXG4gIHVzZXJJbWFnZVNlbGVjdG9yOiBcIi5wcm9maWxlX19pbWFnZVwiXHJcbn1cclxuXHJcbmNvbnN0IHByb21pc2VJbmZvcm1hdGlvbiA9IHtcclxuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLm5vbW9yZXBhcnRpZXMuY28vdjEvZ3JvdXAtMTIvXCIsXHJcbiAgaGVhZGVyczoge1xyXG4gICAgYXV0aG9yaXphdGlvbjogXCJmYTAwMmVhYS1jZmRjLTQ5YjItYmE3YS03NjQwZWI0Njg3NDJcIixcclxuICAgIFwiY29udGVudC10eXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiXHJcbn1cclxufVxyXG5cclxuXHJcbmV4cG9ydCB7IFxyXG4gIGVkaXRQcm9maWxlQnV0dG9uLFxyXG4gIGVkaXRQcm9maWxlUGljQnV0dG9uLFxyXG4gIHByb2ZpbGVNb2RhbCxcclxuICBhZGRDYXJkQnV0dG9uLFxyXG4gIGNhcmRNb2RhbCxcclxuICBwcm9maWxlLFxyXG4gIHByb2ZpbGVGb3JtLFxyXG4gIHByb2ZpbGVOYW1lLFxyXG4gIHByb2ZpbGVEZXNjLFxyXG4gIHByb2ZpbGVJbWFnZSxcclxuICBwcm9maWxlTmFtZUlucHV0LFxyXG4gIHByb2ZpbGVEZXNjSW5wdXQsXHJcbiAgY2FyZEZvcm0sXHJcbiAgY2FyZEZvcm1TdWJtaXQsXHJcbiAgY2FyZEltYWdlSW5wdXQsXHJcbiAgY2FyZE5hbWVJbnB1dCxcclxuICBwb3B1cCxcclxuICBwb3B1cEhlYWRlcixcclxuICBwb3B1cEltYWdlLFxyXG4gIGNvbmZpZyxcclxuICBlc2NhcGVLZXlDb2RlLFxyXG4gIHNlbGVjdG9ycyxcclxuICBwcm9taXNlSW5mb3JtYXRpb24sXHJcbiAgZGVsZXRlSW5wdXRcclxuIH07IiwiaW1wb3J0IHsgZXNjYXBlS2V5Q29kZSB9IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBQb3B1cCB7XHJcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xyXG4gICAgdGhpcy5fcG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fY2xvc2VCdXR0b24gPSB0aGlzLl9wb3B1cC5xdWVyeVNlbGVjdG9yKFwiLmJ1dHRvbl90eXBlX2Nsb3NlXCIpO1xyXG4gIH1cclxuXHJcbiAgb3BlbigpIHtcclxuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgfVxyXG5cclxuICBjbG9zZSgpIHtcclxuICAgIHRoaXMuX3BvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuZWRcIik7XHJcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCB0aGlzLl9oYW5kbGVFc2NDbG9zZSk7XHJcbiAgfVxyXG5cclxuICBfaGFuZGxlRXNjQ2xvc2UgPSAoZXZ0KSA9PiB7XHJcbiAgICBpZiAoZXZ0LmtleUNvZGUgPT09IGVzY2FwZUtleUNvZGUpIHtcclxuICAgICAgdGhpcy5jbG9zZSgpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgX2Nsb3NlTW9kYWxPblJlbW90ZUNsaWNrKGV2dCkge1xyXG4gICAgaWYgKGV2dC50YXJnZXQgPT09IHRoaXMuX3BvcHVwKSB7XHJcbiAgICAgIHRoaXMuY2xvc2UoKTtcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICBzZXRFdmVudExpc3RlbmVycygpIHtcclxuICAgIHRoaXMuX2Nsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLmNsb3NlKCkpO1xyXG4gICAgdGhpcy5fcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZXZ0KSA9PiB0aGlzLl9jbG9zZU1vZGFsT25SZW1vdGVDbGljayhldnQpKTtcclxuICB9XHJcbn0iLCJpbXBvcnQgeyBQb3B1cCB9IGZyb20gXCIuL1BvcHVwXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgUG9wdXBXaXRoRm9ybSBleHRlbmRzIFBvcHVwIHtcclxuICAgIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQpIHtcclxuICAgICAgc3VwZXIocG9wdXBTZWxlY3Rvcik7XHJcbiAgICAgIFxyXG4gICAgICB0aGlzLl9oYW5kbGVTdWJtaXQgPSBoYW5kbGVGb3JtU3VibWl0O1xyXG4gICAgICB0aGlzLl9mb3JtID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5mb3JtXCIpO1xyXG4gICAgICB0aGlzLl9pbnB1dEVscyA9IEFycmF5LmZyb20odGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLmZvcm1fX2lucHV0XCIpKTtcclxuICAgICAgdGhpcy5fc3VibWl0QnRuID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKFwiLmZvcm1fX3N1Ym1pdFwiKTtcclxuICAgICAgdGhpcy5fc3VibWl0QnRuVGV4dCA9IHRoaXMuX3N1Ym1pdEJ0bi50ZXh0Q29udGVudDtcclxuICAgIH1cclxuICBcclxuICAgIF9nZXRJbnB1dFZhbHVlcygpIHtcclxuICAgICAgY29uc3QgZm9ybVZhbHVlcyA9IHt9O1xyXG4gICAgICB0aGlzLl9pbnB1dEVscy5mb3JFYWNoKChpbnB1dCkgPT4ge1xyXG4gICAgICAgIGZvcm1WYWx1ZXNbaW5wdXQubmFtZV0gPSBpbnB1dC52YWx1ZTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBmb3JtVmFsdWVzO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgY2xvc2UoKSB7XHJcbiAgICAgIHRoaXMuX2Zvcm0ucmVzZXQoKTtcclxuICAgICAgc3VwZXIuY2xvc2UoKTtcclxuICAgIH1cclxuXHJcbiAgICByZW5kZXJMb2FkaW5nKGlzTG9hZGluZywgbG9hZGluZ1RleHQ9J1NhdmluZy4uLicpIHtcclxuICAgICAgaWYgKGlzTG9hZGluZykge1xyXG4gICAgICAgIHRoaXMuX3N1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IGxvYWRpbmdUZXh0O1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuX3N1Ym1pdEJ0bi50ZXh0Q29udGVudCA9IHRoaXMuX3N1Ym1pdEJ0blRleHQ7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICBcclxuICAgIHNldEV2ZW50TGlzdGVuZXJzKCkge1xyXG4gICAgICBzdXBlci5zZXRFdmVudExpc3RlbmVycygpO1xyXG4gICAgICB0aGlzLl9mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICAgICAgdGhpcy5yZW5kZXJMb2FkaW5nKHRydWUpO1xyXG5cclxuICAgICAgICBjb25zdCBpbnB1dFZhbHVlcyA9IHRoaXMuX2dldElucHV0VmFsdWVzKCk7XHJcbiAgICAgICAgdGhpcy5faGFuZGxlU3VibWl0KGlucHV0VmFsdWVzKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfSIsImV4cG9ydCBjbGFzcyBTZWN0aW9uIHtcclxuICBjb25zdHJ1Y3Rvcih7IGl0ZW1zLCByZW5kZXJlciB9LCBzZWN0aW9uU2VsZWN0b3IpIHtcclxuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XHJcbiAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xyXG5cclxuICAgIHRoaXMuX3NlY3Rpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHNlY3Rpb25TZWxlY3Rvcik7XHJcbiAgfVxyXG5cclxuICByZW5kZXJJdGVtcygpIHtcclxuICAgIHRoaXMuX2l0ZW1zLmZvckVhY2godGhpcy5fcmVuZGVyZXIpO1xyXG4gIH1cclxuXHJcbiAgYWRkSXRlbShlbGVtZW50KSB7XHJcbiAgICB0aGlzLl9zZWN0aW9uLmFwcGVuZChlbGVtZW50KTtcclxuICB9XHJcblxyXG4gIGFkZE5ld0l0ZW0oZWxlbWVudCkge1xyXG4gICAgdGhpcy5fc2VjdGlvbi5wcmVwZW5kKGVsZW1lbnQpO1xyXG4gIH1cclxufSIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XHJcbmltcG9ydCB7IENhcmQgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9DYXJkXCI7XHJcbmltcG9ydCB7IEZvcm1WYWxpZGF0b3IgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9Gb3JtVmFsaWRhdG9yXCI7XHJcbmltcG9ydCB7IFBvcHVwV2l0aEltYWdlIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvUG9wdXBXaXRoSW1hZ2VcIjtcclxuaW1wb3J0IHsgUG9wdXBXaXRoRm9ybSB9IGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm1cIjtcclxuaW1wb3J0IHsgVXNlckluZm8gfSBmcm9tIFwiLi4vY29tcG9uZW50cy9Vc2VySW5mb1wiO1xyXG5pbXBvcnQgeyBTZWN0aW9uIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvU2VjdGlvblwiO1xyXG5pbXBvcnQgeyBBcGkgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9BcGlcIjtcclxuaW1wb3J0IHtcclxuICBwcm9maWxlLFxyXG4gIGVkaXRQcm9maWxlQnV0dG9uLFxyXG4gIGVkaXRQcm9maWxlUGljQnV0dG9uLFxyXG4gIGFkZENhcmRCdXR0b24sXHJcbiAgcHJvZmlsZU5hbWVJbnB1dCxcclxuICBwcm9maWxlRGVzY0lucHV0LFxyXG4gIGNvbmZpZyxcclxuICBzZWxlY3RvcnMsXHJcbiAgcHJvbWlzZUluZm9ybWF0aW9uLFxyXG4gIGRlbGV0ZUlucHV0LFxyXG59IGZyb20gXCIuLi91dGlscy9jb25zdGFudHMuanNcIjtcclxuXHJcbmNvbnN0IGNyZWF0ZUNhcmQgPSAoY2FyZE9iamVjdCkgPT4ge1xyXG4gIGNvbnN0IGNhcmQgPSBuZXcgQ2FyZChcclxuICAgIHtcclxuICAgICAgZGF0YTogY2FyZE9iamVjdCxcclxuICAgICAgaGFuZGxlQ2FyZFBvcHVwOiAoaW1nRGF0YSkgPT4ge1xyXG4gICAgICAgIGltYWdlUG9wdXAub3BlbihpbWdEYXRhKTtcclxuICAgICAgfSxcclxuICAgICAgaGFuZGxlQ2FyZExpa2U6IChpZCkgPT4ge1xyXG4gICAgICAgIGFwaS5hZGRDYXJkTGlrZShpZClcclxuICAgICAgICAgIC50aGVuKChyZXMpID0+IGNhcmQudXBkYXRlTGlrZXMocmVzKSlcclxuICAgICAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKTtcclxuICAgICAgfSxcclxuICAgICAgaGFuZGxlQ2FyZFVubGlrZTogKGlkKSA9PiB7XHJcbiAgICAgICAgYXBpLnJlbW92ZUNhcmRMaWtlKGlkKVxyXG4gICAgICAgICAgLnRoZW4oKHJlcykgPT4gY2FyZC51cGRhdGVMaWtlcyhyZXMpKVxyXG4gICAgICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpO1xyXG4gICAgICB9LFxyXG4gICAgICBoYW5kbGVUcmFzaFBvcHVwOiAoaWQpID0+IHtcclxuICAgICAgICBmaWxsRGVsZXRlUG9wdXAoaWQpO1xyXG4gICAgICB9LFxyXG4gICAgfSxcclxuICAgIHNlbGVjdG9ycy5jYXJkVGVtcGxhdGUsXHJcbiAgICBwcm9maWxlLmlkXHJcbiAgKTtcclxuICByZXR1cm4gY2FyZC5nZW5lcmF0ZUNhcmQoKTtcclxufTtcclxuXHJcbmNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKHNlbGVjdG9ycyk7XHJcblxyXG5jb25zdCBhcGkgPSBuZXcgQXBpKHByb21pc2VJbmZvcm1hdGlvbik7XHJcblxyXG5mdW5jdGlvbiB1cGRhdGVVc2VyRGF0YShyZXMpIHtcclxuICB7XHJcbiAgICB1c2VySW5mby5zZXRVc2VySW5mbyh7XHJcbiAgICAgIHVzZXJOYW1lOiByZXMubmFtZSxcclxuICAgICAgdXNlckpvYjogcmVzLmFib3V0LFxyXG4gICAgfSk7XHJcbiAgICB1c2VySW5mby5zZXRVc2VySW1hZ2UoeyB1c2VySW1hZ2U6IHJlcy5hdmF0YXIgfSk7XHJcbiAgICBwcm9maWxlLnNldEF0dHJpYnV0ZShcImlkXCIsIHJlcy5faWQpO1xyXG4gIH1cclxufVxyXG5cclxubGV0IGNhcmRTZWN0aW9uID0gbnVsbDtcclxuXHJcblByb21pc2UuYWxsKFthcGkuZ2V0SW5pdGlhbENhcmRzKCksIGFwaS5nZXRVc2VyRGF0YSgpXSlcclxuICAudGhlbigoW2NhcmREYXRhLCB1c2VyRGF0YV0pID0+IHtcclxuICAgIHVwZGF0ZVVzZXJEYXRhKHVzZXJEYXRhKTtcclxuICAgIGNhcmRTZWN0aW9uID0gbmV3IFNlY3Rpb24oXHJcbiAgICAgIHtcclxuICAgICAgICBpdGVtczogY2FyZERhdGEsXHJcbiAgICAgICAgcmVuZGVyZXI6IChkYXRhKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBjYXJkRWwgPSBjcmVhdGVDYXJkKGRhdGEpO1xyXG4gICAgICAgICAgY2FyZFNlY3Rpb24uYWRkSXRlbShjYXJkRWwpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgIH0sXHJcbiAgICAgIFwiLmNhcmRzXCJcclxuICAgICk7XHJcbiAgXHJcbiAgY2FyZFNlY3Rpb24ucmVuZGVySXRlbXMoKTtcclxuICB9KVxyXG4gIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKTtcclxuXHJcbmZ1bmN0aW9uIGZpbGxQcm9maWxlRm9ybSgpIHtcclxuICBjb25zdCB7IHVzZXJOYW1lLCB1c2VySm9iIH0gPSB1c2VySW5mby5nZXRVc2VySW5mbygpO1xyXG5cclxuICBwcm9maWxlTmFtZUlucHV0LnZhbHVlID0gdXNlck5hbWU7XHJcbiAgcHJvZmlsZURlc2NJbnB1dC52YWx1ZSA9IHVzZXJKb2I7XHJcbn1cclxuXHJcbmNvbnN0IGFkZEZvcm0gPSBuZXcgUG9wdXBXaXRoRm9ybShzZWxlY3RvcnMuY2FyZFBvcHVwLCAoZGF0YSkgPT4ge1xyXG4gIGNvbnN0IG5ld0NhcmQgPSB7IG5hbWU6IGRhdGEucGxhY2UsIGxpbms6IGRhdGEubGluayB9O1xyXG4gIGFwaS5wb3N0TmV3Q2FyZChuZXdDYXJkKVxyXG4gICAgLnRoZW4ocmVzID0+IHtcclxuICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gY3JlYXRlQ2FyZChyZXMpO1xyXG4gICAgY2FyZFNlY3Rpb24uYWRkTmV3SXRlbShjYXJkRWxlbWVudCk7XHJcbiAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBhZGRGb3JtLmNsb3NlKCk7XHJcbiAgICAgIGFkZEZvcm0ucmVuZGVyTG9hZGluZyhmYWxzZSk7XHJcbiAgICB9KVxyXG59KTtcclxuXHJcbmFkZEZvcm0uc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmFkZENhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICBhZGRGb3JtVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gIGFkZEZvcm0ub3BlbigpO1xyXG59KTtcclxuXHJcbmNvbnN0IGFkZEZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25maWcsIHNlbGVjdG9ycy5jYXJkRm9ybSk7XHJcbmFkZEZvcm1WYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xyXG5cclxuY29uc3QgcHJvZmlsZUZvcm0gPSBuZXcgUG9wdXBXaXRoRm9ybShzZWxlY3RvcnMucHJvZmlsZVBvcHVwLCAoZGF0YSkgPT4ge1xyXG4gIGNvbnN0IG5ld1VzZXIgPSB7IG5hbWU6IGRhdGEucHJvZmlsZSwgYWJvdXQ6IGRhdGEuZGVzYyB9O1xyXG4gIGFwaS5zdWJtaXRVc2VyRWRpdChuZXdVc2VyKVxyXG4gICAgLnRoZW4ocmVzID0+IHtcclxuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8oe3VzZXJOYW1lOiByZXMubmFtZSwgdXNlckpvYjogcmVzLmFib3V0fSk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKGVycikpXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHByb2ZpbGVGb3JtLmNsb3NlKCk7XHJcbiAgICAgIHByb2ZpbGVGb3JtLnJlbmRlckxvYWRpbmcoZmFsc2UpO1xyXG4gICAgfSlcclxufSk7XHJcblxyXG5wcm9maWxlRm9ybS5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuY29uc3QgZWRpdEZvcm1WYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25maWcsIHNlbGVjdG9ycy5wcm9maWxlRm9ybSk7XHJcbmVkaXRGb3JtVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcclxuXHJcbmVkaXRQcm9maWxlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgZmlsbFByb2ZpbGVGb3JtKCk7XHJcbiAgZWRpdEZvcm1WYWxpZGF0b3IucmVzZXRWYWxpZGF0aW9uKCk7XHJcbiAgcHJvZmlsZUZvcm0ub3BlbigpO1xyXG59KTtcclxuXHJcbmNvbnN0IGRlbGV0ZVBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oc2VsZWN0b3JzLmRlbGV0ZVBvcHVwLCAoZGF0YSkgPT4ge1xyXG4gIGNvbnN0IGNhcmQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkYXRhLmNhcmRJZCk7XHJcbiAgYXBpLmRlbGV0ZUNhcmQoZGF0YS5jYXJkSWQpLnRoZW4oKCkgPT4ge1xyXG4gICAgY2FyZC5yZW1vdmUoKTtcclxuICB9KS5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmxvZyhlcnIpKVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBkZWxldGVQb3B1cC5jbG9zZSgpO1xyXG4gICAgICBkZWxldGVQb3B1cC5yZW5kZXJMb2FkaW5nKGZhbHNlKTtcclxuICAgIH0pXHJcbn0pO1xyXG5cclxuZnVuY3Rpb24gZmlsbERlbGV0ZVBvcHVwKGRhdGEpIHtcclxuICBkZWxldGVJbnB1dC52YWx1ZSA9IGRhdGE7XHJcbiAgZGVsZXRlUG9wdXAub3BlbigpO1xyXG59XHJcblxyXG5kZWxldGVQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xyXG5cclxuY29uc3QgaW1hZ2VQb3B1cCA9IG5ldyBQb3B1cFdpdGhJbWFnZShzZWxlY3RvcnMuaW1hZ2VQb3B1cCk7XHJcbmltYWdlUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcclxuXHJcbmNvbnN0IHByb2ZpbGVQaWNGb3JtVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoXHJcbiAgY29uZmlnLFxyXG4gIHNlbGVjdG9ycy5wcm9maWxlUGljRm9ybVxyXG4pO1xyXG5wcm9maWxlUGljRm9ybVZhbGlkYXRvci5lbmFibGVWYWxpZGF0aW9uKCk7XHJcblxyXG5jb25zdCBwcm9maWxlUGljRm9ybSA9IG5ldyBQb3B1cFdpdGhGb3JtKHNlbGVjdG9ycy5wcm9maWxlUGljUG9wdXAsIChkYXRhKSA9PiB7XHJcbiAgYXBpLnVwZGF0ZVByb2ZpbGVQaWN0dXJlKGRhdGEucHJvZmlsZXBpYylcclxuICAgIC50aGVuKHJlcyA9PiB7XHJcbiAgICAgIHVzZXJJbmZvLnNldFVzZXJJbWFnZSh7dXNlckltYWdlOiByZXMuYXZhdGFyfSlcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5sb2coZXJyKSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgcHJvZmlsZVBpY0Zvcm0uY2xvc2UoKTtcclxuICAgICAgcHJvZmlsZVBpY0Zvcm0ucmVuZGVyTG9hZGluZyhmYWxzZSk7XHJcbiAgICB9KVxyXG59KTtcclxuXHJcbnByb2ZpbGVQaWNGb3JtLnNldEV2ZW50TGlzdGVuZXJzKCk7XHJcblxyXG5lZGl0UHJvZmlsZVBpY0J1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xyXG4gIHByb2ZpbGVQaWNGb3JtVmFsaWRhdG9yLnJlc2V0VmFsaWRhdGlvbigpO1xyXG4gIHByb2ZpbGVQaWNGb3JtLm9wZW4oKTtcclxufSk7IiwiZXhwb3J0IGNsYXNzIFVzZXJJbmZvIHtcclxuICBjb25zdHJ1Y3Rvcih7IHVzZXJOYW1lU2VsZWN0b3IsIHVzZXJKb2JTZWxlY3RvciwgdXNlckltYWdlU2VsZWN0b3IgfSkge1xyXG4gICAgdGhpcy5fbmFtZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHVzZXJOYW1lU2VsZWN0b3IpO1xyXG4gICAgdGhpcy5fam9iRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodXNlckpvYlNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2ltYWdlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodXNlckltYWdlU2VsZWN0b3IpO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlckluZm8oKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICB1c2VyTmFtZTogdGhpcy5fbmFtZUVsZW1lbnQudGV4dENvbnRlbnQsXHJcbiAgICAgIHVzZXJKb2I6IHRoaXMuX2pvYkVsZW1lbnQudGV4dENvbnRlbnQgfTtcclxuICB9XHJcblxyXG4gIHNldFVzZXJJbmZvKHt1c2VyTmFtZSwgdXNlckpvYn0pIHtcclxuICAgIHRoaXMuX25hbWVFbGVtZW50LnRleHRDb250ZW50ID0gdXNlck5hbWU7XHJcbiAgICB0aGlzLl9qb2JFbGVtZW50LnRleHRDb250ZW50ID0gdXNlckpvYjtcclxuICB9XHJcblxyXG4gIHNldFVzZXJJbWFnZSh7dXNlckltYWdlfSkge1xyXG4gICAgdGhpcy5faW1hZ2VFbGVtZW50LnNyYyA9IHVzZXJJbWFnZTtcclxuICB9XHJcbn0iLCJleHBvcnQgY2xhc3MgQXBpIHtcclxuICAgIGNvbnN0cnVjdG9yKHByb21pc2VJbmZvcm1hdGlvbikge1xyXG4gICAgICAgIHRoaXMudXJsID0gcHJvbWlzZUluZm9ybWF0aW9uLmJhc2VVcmw7XHJcbiAgICAgICAgdGhpcy5oZWFkZXJzID0gcHJvbWlzZUluZm9ybWF0aW9uLmhlYWRlcnM7XHJcbiAgICB9XHJcblxyXG4gICAgX2NoZWNrUmVzcG9uc2UocmVzKSB7XHJcbiAgICAgICAgaWYgKHJlcy5vaykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLmpzb24oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvciAke3Jlcy5zdGF0dXN9YCk7XHJcbiAgICB9XHJcblxyXG4gICAgZ2V0VXNlckRhdGEoKSB7XHJcbiAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy51cmx9dXNlcnMvbWVgLCB7XHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVyc1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcclxuICAgIH1cclxuXHJcbiAgICBnZXRJbml0aWFsQ2FyZHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMudXJsfWNhcmRzYCwge1xyXG4gICAgICAgICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnNcclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpXHJcbiAgICB9XHJcblxyXG4gICAgc3VibWl0VXNlckVkaXQoZGF0YSkge1xyXG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLnVybH11c2Vycy9tZWAsIHtcclxuICAgICAgICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyxcclxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xyXG4gICAgICAgICAgICAgICAgbmFtZTogZGF0YS5uYW1lLFxyXG4gICAgICAgICAgICAgICAgYWJvdXQ6IGRhdGEuYWJvdXRcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpXHJcbiAgICB9XHJcblxyXG4gICAgcG9zdE5ld0NhcmQoZGF0YSkge1xyXG4gICAgICAgIHJldHVybiBmZXRjaChgJHt0aGlzLnVybH1jYXJkc2AsIHtcclxuICAgICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxyXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiBkYXRhLm5hbWUsXHJcbiAgICAgICAgICAgICAgICBsaW5rOiBkYXRhLmxpbmtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpXHJcbiAgICB9XHJcblxyXG4gICAgYWRkQ2FyZExpa2UoaWQpIHtcclxuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy51cmx9Y2FyZHMvbGlrZXMvJHtpZH1gLCB7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQVVRcIixcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzXHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKVxyXG4gICAgfVxyXG5cclxuICAgIHJlbW92ZUNhcmRMaWtlKGlkKSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMudXJsfWNhcmRzL2xpa2VzLyR7aWR9YCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVyc1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcclxuICAgIH1cclxuXHJcbiAgICBkZWxldGVDYXJkKGlkKSB7XHJcbiAgICAgICAgcmV0dXJuIGZldGNoKGAke3RoaXMudXJsfWNhcmRzLyR7aWR9YCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICAgICAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVyc1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcclxuICAgIH1cclxuXHJcbiAgICB1cGRhdGVQcm9maWxlUGljdHVyZSh1cmwpIHtcclxuICAgICAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy51cmx9dXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgICAgICAgICAgaGVhZGVyczogdGhpcy5oZWFkZXJzLFxyXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgICAgICBhdmF0YXI6IHVybFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcclxuICAgIH1cclxufSIsImltcG9ydCB7IFBvcHVwIH0gZnJvbSBcIi4vUG9wdXBcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcclxuICBjb25zdHJ1Y3Rvcihwb3B1cFNlbGVjdG9yKSB7XHJcbiAgICBzdXBlcihwb3B1cFNlbGVjdG9yKTtcclxuICAgIHRoaXMuX2ltYWdlRWxlbWVudCA9IHRoaXMuX3BvcHVwLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xyXG4gICAgdGhpcy5faW1hZ2VDYXB0aW9uID0gdGhpcy5fcG9wdXAucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9faGVhZGVyXCIpO1xyXG4gIH1cclxuXHJcbiAgICBvcGVuKGRhdGEpIHtcclxuICAgICAgdGhpcy5faW1hZ2VFbGVtZW50LnNyYyA9IGRhdGEubGluaztcclxuICAgICAgdGhpcy5faW1hZ2VFbGVtZW50LmFsdCA9IGBBIGZ1bGwgc2l6ZSB2aWV3IG9mICR7ZGF0YS5uYW1lfWA7XHJcbiAgICAgIHRoaXMuX2ltYWdlQ2FwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcclxuICAgICAgc3VwZXIub3BlbigpO1xyXG4gICAgfVxyXG4gIH0iXSwibmFtZXMiOlsiQ2FyZCIsImNvbnN0cnVjdG9yIiwiY2FyZFNlbGVjdG9yIiwidXNlcklkIiwiZGF0YSIsImhhbmRsZUNhcmRQb3B1cCIsImhhbmRsZUNhcmRMaWtlIiwiaGFuZGxlQ2FyZFVubGlrZSIsImhhbmRsZVRyYXNoUG9wdXAiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJ0aGlzIiwiX2NhcmRTZWxlY3RvciIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJfZWxlbWVudCIsIl9nZXRUZW1wbGF0ZSIsInNldEF0dHJpYnV0ZSIsIl9pZCIsImNhcmRUaXRsZSIsImNhcmRJbWFnZSIsIl9jYXJkTGlrZUJ1dHRvbiIsIl9jYXJkTGlrZXNDb3VudCIsIl9jYXJkVHJhc2hCdXR0b24iLCJfY2FyZEltYWdlQnV0dG9uIiwidGV4dENvbnRlbnQiLCJfdGl0bGUiLCJzcmMiLCJfbGluayIsImFsdCIsImxpa2VzIiwibGVuZ3RoIiwiX3NldEV2ZW50TGlzdGVuZXJzIiwiX2lzTGlrZWQiLCJfaGFuZGxlQ2FyZExpa2UiLCJfaGFuZGxlQ2FyZFVubGlrZSIsImkiLCJfdXNlcklkIiwiY2xhc3NMaXN0IiwidG9nZ2xlIiwiX293bmVyaWQiLCJyZW1vdmUiLCJfZGF0YSIsIm5hbWUiLCJsaW5rIiwib3duZXIiLCJpbmNsdWRlcyIsIl9oYW5kbGVDYXJkUG9wdXAiLCJfaGFuZGxlVHJhc2hQb3B1cCIsInVwZGF0ZUxpa2VzIiwicmVzIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9oYW5kbGVMaWtlSWNvbiIsIl9jaGVja0NhcmRPd25lcklkIiwiX2NoZWNrTGlrZUljb24iLCJGb3JtVmFsaWRhdG9yIiwic2V0dGluZ3MiLCJmb3JtRWxlbWVudCIsIl9pbnB1dEVscyIsImV2ZXJ5IiwiaW5wdXQiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2lucHV0U2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwiX3N1Ym1pdEJ1dHRvblNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJfaW5hY3RpdmVCdXR0b25DbGFzcyIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJfaW5wdXRFcnJvckNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiX2Vycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiX2Zvcm0iLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwiX3N1Ym1pdEJ1dHRvbiIsIl9zaG93SW5wdXRFcnJvciIsImlucHV0RWxlbWVudCIsImVycm9yTWVzc2FnZUVsIiwiaWQiLCJhZGQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9oaWRlSW5wdXRFcnJvciIsIl90b2dnbGVJbnB1dEVycm9yIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJfY2hlY2tGb3JtVmFsaWRpdHkiLCJkaXNhYmxlZCIsInJlc2V0VmFsaWRhdGlvbiIsImZvckVhY2giLCJlbGVtZW50IiwiZSIsImVuYWJsZVZhbGlkYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsImVkaXRQcm9maWxlQnV0dG9uIiwiZWRpdFByb2ZpbGVQaWNCdXR0b24iLCJwcm9maWxlTW9kYWwiLCJhZGRDYXJkQnV0dG9uIiwiY2FyZE1vZGFsIiwicHJvZmlsZSIsInByb2ZpbGVGb3JtIiwicHJvZmlsZU5hbWVJbnB1dCIsInByb2ZpbGVEZXNjSW5wdXQiLCJjYXJkRm9ybSIsInBvcHVwIiwiZGVsZXRlSW5wdXQiLCJjb25maWciLCJmb3JtU2VsZWN0b3IiLCJzZWxlY3RvcnMiLCJjYXJkUG9wdXAiLCJpbWFnZVBvcHVwIiwicHJvZmlsZVBvcHVwIiwicHJvZmlsZVBpY1BvcHVwIiwiZGVsZXRlUG9wdXAiLCJwcm9maWxlUGljRm9ybSIsImNhcmRUZW1wbGF0ZSIsInVzZXJOYW1lU2VsZWN0b3IiLCJ1c2VySm9iU2VsZWN0b3IiLCJ1c2VySW1hZ2VTZWxlY3RvciIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsImV2dCIsImtleUNvZGUiLCJjbG9zZSIsIl9wb3B1cCIsIl9jbG9zZUJ1dHRvbiIsIm9wZW4iLCJfaGFuZGxlRXNjQ2xvc2UiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiX2Nsb3NlTW9kYWxPblJlbW90ZUNsaWNrIiwidGFyZ2V0Iiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJQb3B1cFdpdGhGb3JtIiwiaGFuZGxlRm9ybVN1Ym1pdCIsInN1cGVyIiwiX2hhbmRsZVN1Ym1pdCIsIl9zdWJtaXRCdG4iLCJfc3VibWl0QnRuVGV4dCIsIl9nZXRJbnB1dFZhbHVlcyIsImZvcm1WYWx1ZXMiLCJ2YWx1ZSIsInJlc2V0IiwicmVuZGVyTG9hZGluZyIsImlzTG9hZGluZyIsImxvYWRpbmdUZXh0IiwiZXZlbnQiLCJpbnB1dFZhbHVlcyIsIlNlY3Rpb24iLCJzZWN0aW9uU2VsZWN0b3IiLCJpdGVtcyIsInJlbmRlcmVyIiwiX2l0ZW1zIiwiX3JlbmRlcmVyIiwiX3NlY3Rpb24iLCJyZW5kZXJJdGVtcyIsImFkZEl0ZW0iLCJhcHBlbmQiLCJhZGROZXdJdGVtIiwicHJlcGVuZCIsImNyZWF0ZUNhcmQiLCJjYXJkT2JqZWN0IiwiY2FyZCIsImltZ0RhdGEiLCJhcGkiLCJhZGRDYXJkTGlrZSIsInRoZW4iLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJsb2ciLCJyZW1vdmVDYXJkTGlrZSIsImdlbmVyYXRlQ2FyZCIsInVzZXJJbmZvIiwiX25hbWVFbGVtZW50IiwiX2pvYkVsZW1lbnQiLCJfaW1hZ2VFbGVtZW50IiwiZ2V0VXNlckluZm8iLCJ1c2VyTmFtZSIsInVzZXJKb2IiLCJzZXRVc2VySW5mbyIsInNldFVzZXJJbWFnZSIsInVzZXJJbWFnZSIsInByb21pc2VJbmZvcm1hdGlvbiIsInVybCIsImJhc2VVcmwiLCJoZWFkZXJzIiwiX2NoZWNrUmVzcG9uc2UiLCJvayIsImpzb24iLCJQcm9taXNlIiwicmVqZWN0Iiwic3RhdHVzIiwiZ2V0VXNlckRhdGEiLCJmZXRjaCIsImdldEluaXRpYWxDYXJkcyIsInN1Ym1pdFVzZXJFZGl0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJhYm91dCIsInBvc3ROZXdDYXJkIiwiZGVsZXRlQ2FyZCIsInVwZGF0ZVByb2ZpbGVQaWN0dXJlIiwiYXZhdGFyIiwiYXV0aG9yaXphdGlvbiIsImNhcmRTZWN0aW9uIiwiYWxsIiwiY2FyZERhdGEiLCJ1c2VyRGF0YSIsImNhcmRFbCIsImFkZEZvcm0iLCJuZXdDYXJkIiwicGxhY2UiLCJjYXJkRWxlbWVudCIsImZpbmFsbHkiLCJhZGRGb3JtVmFsaWRhdG9yIiwibmV3VXNlciIsImRlc2MiLCJlZGl0Rm9ybVZhbGlkYXRvciIsImZpbGxQcm9maWxlRm9ybSIsImdldEVsZW1lbnRCeUlkIiwiY2FyZElkIiwiX2ltYWdlQ2FwdGlvbiIsInByb2ZpbGVQaWNGb3JtVmFsaWRhdG9yIiwicHJvZmlsZXBpYyJdLCJzb3VyY2VSb290IjoiIn0=